/* frontend/style.css - FINAL VERSION (With Theme Engine & Visualizer Fixes) */

/* --- FONTS & VARIABLES --- */
@import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');

/* --- THEME ENGINE --- */
:root {
    /* 1. Global Defaults (The "Aurora" Theme) */
    --bg-image: url('https://images.unsplash.com/photo-1531366936337-7c912a4589a7?q=80&w=2070&auto=format&fit=crop');
    --bg-overlay: linear-gradient(rgba(11, 16, 38, 0.6), rgba(11, 16, 38, 0.3));
    
    --glass-panel: rgba(18, 24, 38, 0.85);
    --glass-border: rgba(169, 218, 255, 0.15);
    
    /* UI Accent Colors */
    --accent-primary: #00fff2;   /* Aurora Teal */
    --accent-secondary: #bd00ff; /* Aurora Purple */
    --accent-warn: #ffb700;      /* Warm Gold */
    --accent-text: #ffffff;      /* Starlight */
    
    /* Text Colors */
    --text-main: #e0e6ed;
    --text-muted: #94a3b8;
    
    /* Shapes */
    --radius-xl: 12px;  /* Panels */
    --radius-lg: 8px;   /* Cards */
    --radius-md: 6px;   /* Buttons/Inputs */
    --radius-sm: 4px;   /* Small elements */
}

/* --- CHRISTMAS THEME (FIXED BACKGROUND) --- */
[data-theme="christmas"] {
    /* 1. Background: Clear Warm Fireplace */
    --bg-image: url('option4.jpg'); 
    
    /* Overlay: Simple dark warm layer to make text readable over the fire */
    --bg-overlay: linear-gradient(rgba(30, 10, 5, 0.7), rgba(30, 10, 5, 0.7));

    /* 2. Panels: Warm "Hearth" Tones */
    --glass-panel: rgba(40, 15, 10, 0.92); 
    --glass-border: rgba(255, 215, 0, 0.25); /* Subtle Gold Border */

    /* 3. Accents */
    --accent-primary: #2ecc71;   /* Christmas Tree Green */
    --accent-secondary: #ff3333; /* Berry/Santa Red */
    --accent-warn: #ffd700;      /* Star Gold */
    --accent-text: #fffce8;      /* Warm candlelight white text */

    /* 4. Text Colors */
    --text-main: #f5ebd0;        /* Parchment/Cream */
    --text-muted: #dcc;          /* Muted Rose/Mauve */

    /* 5. Shapes: Cozier, softer corners */
    --radius-xl: 16px; 
    --radius-lg: 12px;
    --radius-md: 8px;
    --radius-sm: 6px;
}

/* --- CHRISTMAS SPECIFIC OVERRIDES --- */

/* Make the title glow like a fireplace/Christmas light */
[data-theme="christmas"] h1 {
    text-shadow: 0 0 15px rgba(255, 50, 50, 0.6), 0 0 30px #ffd700;
    color: var(--accent-warn); /* Gold Text */
}

/* Make the fretboard look more like rich mahogany/wood */
[data-theme="christmas"] .neck-wrapper {
    background: repeating-linear-gradient(90deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 1px, transparent 10px),
                linear-gradient(to bottom, #3e2723, #281815); /* Darker, warmer wood */
    border-color: #5d4037;
}

/* Inlays become "Snow" dots */
[data-theme="christmas"] .inlay-dot {
    background: #fff;
    box-shadow: 0 0 8px #fff; /* Glowing snow */
    opacity: 0.8;
}

/* --- CHRISTMAS: FRETBOARD COLOR OVERRIDES --- */

/* 1. Main Fretboard (The "Playing" Board) */
/* Change the default Orange marker to a Glowing Christmas Light (Red/Gold) */
[data-theme="christmas"] .note-marker {
    background: radial-gradient(circle at 30% 30%, #ffeb3b, #f57f17); /* Golden Bulb */
    box-shadow: 0 0 8px #fbc02d;
    color: #3e2723; /* Dark Wood text */
}

/* 2. Visualizer Layers (The "Theory" Board) */

/* Layer 1: Diatonic (Context) -> Forest Green Tint */
[data-theme="christmas"] .fret-cell.layer-diatonic {
    background: rgba(46, 125, 50, 0.25) !important; 
    box-shadow: inset 0 0 8px rgba(46, 125, 50, 0.4);
}
[data-theme="christmas"] .fret-cell.layer-diatonic:not(.layer-chord) .note-marker {
    color: #81c784; /* Light Green Text */
}

/* Layer 2: Pentatonic (Safe Zones) -> Candy Cane Red Ring */
[data-theme="christmas"] .fret-cell.layer-penta::before {
    border-color: #d32f2f; /* Deep Red */
    box-shadow: 0 0 8px rgba(211, 47, 47, 0.6);
}
[data-theme="christmas"] .fret-cell.layer-penta:not(.layer-chord) .note-marker {
    color: #ff8a80; /* Pinkish Red Text */
}

/* Layer 3: Chord (Target) -> Bright Golden Star */
[data-theme="christmas"] .fret-cell.layer-chord .note-marker {
    background: radial-gradient(circle at 30% 30%, #fff59d, #fbc02d) !important; /* Gold */
    color: #3e2723 !important; /* Brown Text */
    box-shadow: 0 0 12px #ffeb3b !important;
}

/* 3. Visualizer Toggles (Match the new scheme) */
[data-theme="christmas"] .viz-toggle input:checked + .viz-btn.chord { 
    background: #fbc02d; color: #3e2723; /* Gold */
}
[data-theme="christmas"] .viz-toggle input:checked + .viz-btn.penta { 
    background: #d32f2f; color: #fff; /* Red */
}
[data-theme="christmas"] .viz-toggle input:checked + .viz-btn.diatonic { 
    background: #2e7d32; color: #fff; /* Green */
}

/* --- CHRISTMAS: BACKGROUND & GREEN OVERRIDES --- */

/* 1. Fix Background & Base Color */
[data-theme="christmas"] body {
    background-color: #2b120a; 
    background-image: 
        var(--bg-overlay), 
        var(--bg-image);
    background-size: cover;
    background-attachment: fixed;
    background-position: center;
}

/* 2. Turn the "Blue" Chord Cards into "Forest Green" Cards */
[data-theme="christmas"] .chord-control-card {
    background: linear-gradient(180deg, #165b33 0%, #0b2e1a 100%) !important;
    border-color: #2e7d32;
    box-shadow: 0 4px 15px rgba(0, 50, 0, 0.5);
}

/* The "Active" card gets a Golden Green glow */
[data-theme="christmas"] .chord-control-card.explorer {
    background: linear-gradient(180deg, #1b5e20 0%, #003300 100%) !important;
    border-color: #ffd700; /* Gold Border */
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
}

/* 3. Turn the Timeline & Control Bars Green */
[data-theme="christmas"] .area-timeline, 
[data-theme="christmas"] .beat-cell {
    background-color: rgba(20, 50, 30, 0.4) !important;
    border-color: rgba(100, 200, 100, 0.2);
}

/* 4. Update Buttons to match (Red/Green theme) */
[data-theme="christmas"] .action-btn.secondary,
[data-theme="christmas"] .remove-btn { 
    background: rgba(30, 80, 40, 0.6);
    border: 1px solid #4caf50;
}

/* 5. Fix the Recs Box (The gray box) */
[data-theme="christmas"] .recs-box {
    background: rgba(20, 50, 30, 0.6); /* Dark Green Glass */
    border: 1px solid rgba(255, 215, 0, 0.3); /* faint gold border */
}

/* --- CHRISTMAS: TOP SNOW ONLY (Simplified) --- */

/* Target ONLY the title area for snow */
[data-theme="christmas"] .area-title {
    position: relative;
    /* A thick white glowing border on top */
    border-top: 10px solid rgba(255,255,255,0.9);
    border-radius: 15px; /* Round corners so snow curves */
    /* Glow effect for the snow */
    box-shadow: 0 -10px 20px rgba(255,255,255,0.8), inset 0 5px 10px rgba(255,255,255,0.4);
    /* Move it down slightly so the new top border doesn't get cut off by the browser window */
    margin-top: 15px; 
    z-index: 100;
}

/* Add the icicle drips back, only to the top title bar */
[data-theme="christmas"] .area-title::after {
    content: '';
    position: absolute;
    top: 10px; /* adjusted for new border */
    right: 30px;
    width: 8px; height: 30px;
    background: #fff;
    border-radius: 0 0 10px 10px;
    box-shadow: -20px -10px 0 #fff, -40px -5px 0 #fff; /* Multiple drips */
    opacity: 0.9;
    pointer-events: none;
}

/* --- GLOBAL RESET --- */
* { box-sizing: border-box; }

body { 
    font-family: 'Quicksand', sans-serif;
    margin: 0; padding: 0;
    color: var(--text-main);
    
    /* Use Variables here */
    background: var(--bg-overlay), var(--bg-image);
    background-size: cover;
    background-attachment: fixed;
    background-position: center;
    
    height: 100vh;
    overflow: hidden;
    user-select: none;
    transition: background 0.5s ease;
}

/* --- DASHBOARD GRID --- */
.dashboard-container {
    display: grid;
    height: 100%;
    width: 100%;
    padding: 15px;
    gap: 15px;
    
    grid-template-columns: 320px 1fr 280px; 
    grid-template-rows: 
        50px    /* Title */
        60px    /* Settings */
        1fr     /* Workspace (Center) */
        50px    /* Controls */
        180px;  /* Timeline */
        
    grid-template-areas: 
        "title title title"
        "settings settings settings"
        "palette center analysis"
        "controls controls controls"
        "timeline timeline timeline";
}

/* --- SHARED STYLES --- */
.glass-panel {
    background: var(--glass-panel);
    backdrop-filter: blur(12px); 
    border-radius: var(--radius-xl); 
    border: 1px solid var(--glass-border);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    padding: 10px;
}

/* --- ZONE 1: TITLE --- */
.area-title {
    grid-area: title;
    display: flex; align-items: center; justify-content: center;
    background: rgba(11, 16, 38, 0.9);
}
h1 { 
    margin: 0; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 2px; 
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.4), 0 0 30px var(--accent-primary); 
    color: var(--accent-text); 
}

/* --- ZONE 2: SETTINGS --- */
.area-settings {
    grid-area: settings;
    display: flex; align-items: center; gap: 20px; padding: 0 20px;
}
.control-group.horizontal { display: flex; align-items: center; gap: 10px; }
.control-group label { 
    font-size: 0.75em; font-weight: 700; color: var(--accent-primary); 
    text-transform: uppercase; margin: 0; 
}
select, input {
    padding: 6px 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: var(--radius-md);
    background-color: rgba(13, 19, 33, 0.8); color: var(--accent-text); 
    font-family: inherit; font-weight: bold;
}
#userIdDisplay { 
    background: rgba(255, 255, 255, 0.1); padding: 5px 10px; 
    border-radius: 20px; font-size: 0.8em; border: 1px solid var(--glass-border); 
    color: var(--text-muted); 
}

/* --- ZONE 3: PALETTE --- */
.area-palette {
    grid-area: palette;
    overflow-y: auto;
    display: flex; flex-direction: column; align-items: center;
    background: rgba(15, 20, 35, 0.9); 
}
.panel-label { 
    width: 100%; text-align: center; font-size: 11px; text-transform: uppercase; 
    color: var(--text-muted); font-weight: bold; margin-bottom: 15px; 
    border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; 
}

.palette-grid-vertical {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; width: 100%;
}

.chord-control-card {
    background: linear-gradient(180deg, #1a1e29 0%, #11141c 100%);
    border: 1px solid #333842;
    border-radius: var(--radius-xl);
    padding: 10px;
    width: 130px;
    display: flex; flex-direction: column; align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    transition: transform 0.2s, border-color 0.2s;
}

/* --- EXPLORER CARD (THE ACTIVE CONTROL) --- */
.chord-control-card.explorer {
    border: 2px solid var(--accent-primary);
    box-shadow: 0 0 15px rgba(0, 255, 242, 0.15);
    background: linear-gradient(180deg, #15202b 0%, #0d1218 100%);
    order: -1; 
}

.chord-control-card.explorer .card-degree {
    color: var(--accent-primary);
    text-shadow: 0 0 8px rgba(0, 255, 242, 0.6);
    font-size: 11px; letter-spacing: 1px;
}

.chord-control-card:hover { transform: translateY(-2px); border-color: var(--accent-primary); }
.chord-control-card.selected { border-color: var(--accent-warn); box-shadow: 0 0 15px rgba(255, 183, 0, 0.2); }
.card-degree { font-size: 14px; font-weight: 800; color: #6b7280; margin-bottom: 8px; }
.chord-control-card.selected .card-degree { color: var(--accent-warn); text-shadow: 0 0 5px var(--accent-warn); }
.card-main { width: 100%; display: flex; flex-direction: column; gap: 4px; }
.card-arrow { background: rgba(255,255,255,0.03); border-radius: var(--radius-sm); cursor: pointer; color: #555; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
.card-arrow:hover { background: rgba(255,255,255,0.1); color: var(--accent-text); }
.card-arrow.vert { width: 100%; height: 20px; font-size: 10px; }
.card-arrow.vert:hover { background: var(--accent-primary); color: #000; }
.card-mid-row { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 5px 0; }
.card-arrow.horz { width: 24px; height: 30px; font-size: 12px; }
.card-arrow.horz:hover { background: var(--accent-warn); color: #000; }
.card-chord-name { text-align: center; flex: 1; }
.card-chord-name .root { display: block; font-size: 20px; font-weight: 700; color: white; line-height: 1; }
.card-chord-name .qual { display: block; font-size: 12px; font-weight: 600; color: var(--accent-primary); margin-top: 2px; }
.card-shape-name { margin-top: 8px; background: #000; border: 1px solid #333; padding: 3px 8px; border-radius: 10px; font-size: 9px; color: #888; text-transform: uppercase; }
.chord-control-card.selected .card-shape-name { background: var(--accent-warn); color: #000; border-color: var(--accent-warn); font-weight: bold; }

/* --- ZONE 4 & 5: CENTER --- */
.area-center {
    grid-area: center;
    display: flex; flex-direction: column; 
    gap: 10px; 
    min-width: 0;
    overflow-y: auto; padding-right: 10px; 
    scrollbar-width: thin; scrollbar-color: var(--accent-primary) transparent;
}

.empty-state { font-style: italic; color: rgba(255,255,255,0.4); font-size: 0.9em; }

.fretboard-box, .visualizer-box {
    flex: 0 0 auto; width: 100%;
    display: flex; flex-direction: column; align-items: center; 
}

.fretboard-center-wrapper { width: 100%; max-width: 760px; }

/* Fretboard Structure */
.fretboard-container { display: flex; flex-direction: column; }
.fret-numbers { display: flex; padding-left: 30px; margin-bottom: 2px; }
.fret-number { 
    flex: 1; text-align: center; font-size: 10px; 
    color: var(--accent-primary); font-weight: bold; 
    text-shadow: 0 1px 2px black; opacity: 0.7;
}

.neck-wrapper {
    display: flex; 
    background: repeating-linear-gradient(90deg, rgba(255,255,255,0.02) 0px, rgba(255,255,255,0.02) 1px, transparent 1px, transparent 10px),
                linear-gradient(to bottom, #2e2624, #1a1614);
    border-radius: var(--radius-md); 
    box-shadow: 0 10px 30px rgba(0,0,0,0.8);
    border: 2px solid #3d312e;
    overflow: hidden;
}

.string-labels { width: 20px; display: flex; flex-direction: column; justify-content: space-around; background: #0f0c0a; border-right: 2px solid #5c5c5c; }
.string-name { color: var(--warm-orange); font-size: 9px; text-align: center; font-weight: bold; }

.fret-grid { display: flex; flex-direction: column; flex-grow: 1; }
.string-row { display: flex; height: 28px; position: relative; }

/* Strings */
.string-row::before { 
    content: ''; position: absolute; left: 0; right: 0; top: 50%; 
    transform: translateY(-50%); background: #e2e2e2; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.8); pointer-events: none; z-index: 5; 
}
.string-row:nth-child(1)::before { height: 1px; opacity: 0.6; } 
.string-row:nth-child(2)::before { height: 1px; opacity: 0.8; } 
.string-row:nth-child(3)::before { height: 2px; opacity: 0.9; } 
.string-row:nth-child(4)::before { height: 2px; opacity: 1.0; } 
.string-row:nth-child(5)::before { height: 3px; opacity: 1.0; } 
.string-row:nth-child(6)::before { height: 4px; opacity: 1.0; }

.fret-cell { border-right: 2px solid #888; border-left: 1px solid #111; position: relative; cursor: pointer; flex: 1; z-index: 10; }
.fret-cell:hover { background: rgba(255, 255, 255, 0.08); }
.fret-cell.nut { width: 30px; flex: none; background: #000; border-right: 4px solid #e0e0e0; border-left: none;}

/* Note Marker (Main) */
.note-marker { 
    width: 20px; height: 20px; 
    background: radial-gradient(circle at 30% 30%, #ffd700, #ff8c00); 
    border-radius: 50%; box-shadow: 0 0 10px #ff8c00; 
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
    display: none; z-index: 20; 
    font-size: 9px; color: #3e1404; align-items: center; justify-content: center; font-weight: bold;
}
.fret-cell.active .note-marker { display: flex; }
.inlay-dot { width: 8px; height: 8px; background: #fff; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.3; pointer-events: none; z-index: 1; box-shadow: 0 0 5px white;}

/* --- VISUALIZER SPECIFIC --- */
.visualizer-box { margin-top: 5px; opacity: 0.9; }
.fretboard-container.visualizer .fret-cell { cursor: default; }
.fretboard-container.visualizer .fret-cell:hover { background: transparent; }
.fretboard-container.visualizer .neck-wrapper { border-color: #2c3e50; filter: brightness(0.85); }

/* --- VISUALIZER CONTROLS (Updated) --- */
.viz-controls {
    display: flex; align-items: center; gap: 15px; justify-content: center; margin-bottom: 10px;
}
.viz-toggle { position: relative; cursor: pointer; user-select: none; }
.viz-toggle input { display: none; }

.viz-btn {
    font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-muted);
    padding: 6px 12px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
    background: rgba(0,0,0,0.4); transition: all 0.2s ease;
    display: flex; align-items: center; gap: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.viz-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-1px); }

/* Toggle Active States */
.viz-toggle input:checked + .viz-btn.chord { 
    background: var(--accent-primary); color: #0b1026; border-color: var(--accent-primary);
    box-shadow: 0 0 12px rgba(0, 255, 242, 0.4); 
}
.viz-toggle input:checked + .viz-btn.penta { 
    background: #ff2a2a; color: #fff; border-color: #ff2a2a;
    box-shadow: 0 0 12px rgba(255, 42, 42, 0.6); 
}
.viz-toggle input:checked + .viz-btn.diatonic { 
    background: #00e676; color: #0b1026; border-color: #00e676;
    box-shadow: 0 0 12px rgba(0, 230, 118, 0.4); 
}

/* --- VISUALIZER LAYERS (STACKING FIX) --- */

/* LAYER 1: DIATONIC (Green Background) */
.fret-cell.layer-diatonic {
    background: rgba(0, 230, 118, 0.15) !important; 
    box-shadow: inset 0 0 8px rgba(0, 230, 118, 0.3);
    transition: background 0.2s;
}

/* LAYER 2: PENTATONIC (Red Ring) */
.fret-cell.layer-penta::before {
    content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 28px; height: 28px; border: 2px solid #ff2a2a; border-radius: 50%;
    z-index: 15; pointer-events: none;
    box-shadow: 0 0 8px rgba(255, 42, 42, 0.8);
}

/* LAYER 3: CHORD (Solid Blue Dot) */
.fret-cell.layer-chord .note-marker {
    display: flex !important;
    width: 20px; height: 20px;
    background: radial-gradient(circle at 30% 30%, #00f2ff, #0097a7) !important;
    color: #00363a !important;
    box-shadow: 0 0 10px #00e5ff !important;
    z-index: 20; font-weight: 800;
}

/* TEXT VISIBILITY LOGIC (Handling Ghost Notes) */
.fret-cell.layer-diatonic:not(.layer-chord) .note-marker {
    display: flex; background: transparent; color: #00e676;
    font-size: 9px; font-weight: 700; box-shadow: none; text-shadow: 0 0 5px rgba(0,0,0,0.8);
}
.fret-cell.layer-penta:not(.layer-chord) .note-marker {
    display: flex; background: transparent; color: #ff2a2a;
    font-size: 9px; font-weight: 700; box-shadow: none; text-shadow: 0 0 5px rgba(0,0,0,0.8); z-index: 20;
}
.fret-cell.layer-penta.layer-diatonic:not(.layer-chord) .note-marker { color: #ff2a2a; }

/* --- ZONE 6: ANALYSIS --- */
.area-analysis {
    grid-area: analysis;
    display: flex; flex-direction: column; gap: 15px;
}
.chord-box { text-align: center; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
.chord-label { text-transform: uppercase; font-size: 10px; letter-spacing: 2px; color: var(--accent-primary); margin-bottom: 5px; font-weight: bold; }
.chord-name { font-size: 32px; font-weight: 700; color: var(--accent-warn); margin-bottom: 5px; text-shadow: 0 0 15px rgba(255, 183, 0, 0.4); }
.chord-details { font-size: 12px; color: var(--text-muted); font-style: italic; }

.chord-list-vertical {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; max-height: 150px; overflow-y: auto;
}
.alt-chord-tag { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 15px; font-size: 12px; color: var(--text-main); cursor: pointer; }
.alt-chord-tag:hover { background: var(--accent-warn); color: #000; }

.right-actions { margin-top: auto; display: flex; flex-direction: column; gap: 10px; }

/* --- ZONE 7: CONTROLS --- */
.area-controls {
    grid-area: controls;
    display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
}
.control-cluster { display: flex; gap: 10px; }

/* --- ZONE 8: TIMELINE --- */
.area-timeline {
    grid-area: timeline;
    background: rgba(0,0,0,0.3);
    overflow-x: auto; padding: 10px 20px;
    display: flex; align-items: center;
}
.timeline-wrapper { display: flex; height: 100%; min-width: 100%; align-items: center; }
.timeline-row { display: inline-flex; align-items: center; gap: 15px; }
.bar-group { display: flex; gap: 8px; padding: 10px; border: 1px dashed rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.2); position: relative; margin-top: 10px; }
.bar-label-tag { position: absolute; top: -18px; left: 0; font-size: 10px; color: var(--text-muted); font-weight: bold; text-transform: uppercase; }
.beat-cell {
    width: 65px; height: 100px;
    background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: var(--radius-md);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; position: relative; transition: all 0.2s;
}
.beat-cell:hover { border-color: var(--accent-primary); background: rgba(255,255,255,0.1); transform: translateY(-3px); }
.beat-cell.selected { border-color: var(--accent-warn) !important; box-shadow: 0 0 15px rgba(255, 183, 0, 0.4); transform: scale(1.05); background: rgba(255, 183, 0, 0.1); }
.beat-cell.playing { border-color: var(--accent-secondary) !important; box-shadow: 0 0 20px var(--accent-secondary); transform: scale(1.1); background: rgba(189, 0, 255, 0.2); }
.cell-label { font-size: 9px; color: rgba(255,255,255,0.4); position: absolute; top: 4px; left: 4px; }
.cell-chord { font-size: 15px; font-weight: bold; color: white; }

/* --- BUTTONS --- */
.action-btn, .save-btn, .remove-btn, .transport-btn { 
    border: none; border-radius: var(--radius-md); cursor: pointer; 
    font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; 
    color: white; font-size: 11px; padding: 10px 15px; transition: 0.2s; 
}

/* Small Fretboard/Control Buttons */
.small-btn {
    padding: 6px 12px; font-size: 10px;
    display: flex; align-items: center; gap: 6px;
    min-width: 80px; justify-content: center;
}

/* Colors */
.action-btn.purple { background: linear-gradient(135deg, #8e44ad, #9b59b6); box-shadow: 0 4px 10px rgba(142, 68, 173, 0.4); }
.action-btn.purple:hover { filter: brightness(1.2); transform: translateY(-1px); }

.action-btn.blue { background: linear-gradient(135deg, #3498db, #2980b9); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4); }
.action-btn.blue:hover { filter: brightness(1.2); transform: translateY(-1px); }

#removeChordBtn { background: linear-gradient(135deg, #e67e22, #d35400); box-shadow: 0 4px 10px rgba(230, 126, 34, 0.3); }
#removeChordBtn:hover { filter: brightness(1.2); transform: translateY(-1px); }

#clearTimelineBtn { background: linear-gradient(135deg, #c0392b, #b03a2e); box-shadow: 0 4px 10px rgba(192, 57, 43, 0.3); margin-left: 5px; }
#clearTimelineBtn:hover { filter: brightness(1.2); transform: translateY(-1px); }

.transport-btn.play { background: linear-gradient(135deg, #00b09b, #96c93d); }
.transport-btn.stop { background: linear-gradient(135deg, #cb2d3e, #ef473a); }

.save-btn { background: linear-gradient(135deg, #2b32b2, #1488cc); }
.action-btn.secondary { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
.action-btn.secondary:hover { background: rgba(255,255,255,0.2); }

.action-btn.hero-add { 
    background: linear-gradient(135deg, #00c6ff, #0072ff); 
    box-shadow: 0 0 20px rgba(0, 114, 255, 0.4); 
    padding: 15px; font-size: 13px; letter-spacing: 1px;
}
.action-btn.hero-add:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(0, 114, 255, 0.6); }

/* --- DRAG AND DROP VISUALS --- */
.beat-cell.dragging { opacity: 0.4; border: 2px dashed #777; transform: scale(0.95); background: rgba(0,0,0,0.5); }
.beat-cell.drag-over { background: rgba(0, 255, 242, 0.15) !important; border-color: var(--accent-primary) !important; transform: scale(1.05); box-shadow: 0 0 15px rgba(0, 255, 242, 0.4); z-index: 100; }
.beat-cell[class*="color-"] { border-bottom: 4px solid var(--chord-color); }
.beat-cell[draggable="true"] { cursor: grab; }
.beat-cell[draggable="true"]:active { cursor: grabbing; }

/* --- EMOTIONAL CONTEXT BOX --- */
.emotion-box {
    margin-top: 10px; padding: 12px; background: rgba(0, 0, 0, 0.3);
    border-radius: var(--radius-lg); flex-grow: 1;
    border-left: 4px solid var(--accent-secondary); transition: border-color 0.3s ease;
}
.emotion-text { font-size: 13px; color: #d1d5db; font-style: italic; line-height: 1.4; text-align: left; }
.emotion-box[class*="color-"] { border-left-color: var(--chord-color) !important; }

/* --- RECOMMENDATION BOX --- */
.recs-box {
    flex: 0 0 20%; background: rgba(0,0,0,0.2); border-radius: var(--radius-lg); padding: 10px; position: relative; 
    display: flex; justify-content: center; align-items: center;
}
.recs-card-container { display: flex; gap: 10px; margin-top: 15px; width: 100%; justify-content: center; overflow-x: auto; }
.rec-card {
    background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: var(--radius-md);
    padding: 8px 12px; min-width: 100px; cursor: pointer; transition: all 0.2s;
    text-align: center; display: flex; flex-direction: column; justify-content: center;
}
.rec-card:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

.rec-res { border-bottom: 3px solid #2ecc71; } 
.rec-motion { border-bottom: 3px solid #f1c40f; } 
.rec-contrast { border-bottom: 3px solid #9b59b6; }
.rec-flow { border-bottom: 3px solid #3498db; } 
.rec-spice { border-bottom: 3px solid #e056fd; } 
.rec-stasis { border-bottom: 3px solid #00d2d3; } 

.rec-chord { font-size: 16px; font-weight: 700; color: var(--accent-text); }
.rec-reason { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

/* --- DYNAMIC CHORD COLOR ENGINE (Unchanged) --- */
.color-major-triad { --chord-color: #FFD700; } 
.color-major-6     { --chord-color: #F48FB1; } 
.color-major-7     { --chord-color: #8EA4D2; } 
.color-minor-triad { --chord-color: #C0392B; } 
.color-minor-7     { --chord-color: #8E44AD; } 
.color-minor-6     { --chord-color: #546E7A; } 
.color-minor-dark  { --chord-color: #1a252f; } 
.color-dom-7       { --chord-color: #077b2f; } 
.color-dom-9       { --chord-color: #FF7F50; } 
.color-dom-alt     { --chord-color: #D500F9; } 
.color-sus-2       { --chord-color: #B3E5FC; } 
.color-sus-4       { --chord-color: #455A64; } 
.color-dim-triad   { --chord-color: #7B1FA2; } 
.color-dim-7       { --chord-color: #311B92; } 
.color-aug         { --chord-color: #9575CD; } 
.color-power       { --chord-color: #616161; } 
.color-add         { --chord-color: #ECF0F1; }